# Vercel Subscription Endpoints Fix

## üîß –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –¥–µ–ø–ª–æ–µ–º –Ω–∞ Vercel –≤–æ–∑–Ω–∏–∫–∞–ª–∏ –æ—à–∏–±–∫–∏ 404 –¥–ª—è —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –ø–æ–¥–ø–∏—Å–∫–∏:

```
POST /api/v1/subscription/create-payment-link 404 (Not Found)
Error starting checkout: Failed to start checkout process
```

### –ü—Ä–∏—á–∏–Ω–∞

–í —Ñ–∞–π–ª–µ `api/main.py` (–∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ Vercel) **–æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏** –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ Stripe. –≠—Ç–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –±—ã–ª–∏ —Ç–æ–ª—å–∫–æ –≤ `backend/main.py` (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏).

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Å–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø–æ–¥–ø–∏—Å–∫–∏ –≤ `api/main.py`:

### –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:

1. **GET `/api/v1/subscription/info`** - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–¥–ø–∏—Å–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **POST `/api/v1/subscription/checkout`** - —Å–æ–∑–¥–∞–Ω–∏–µ Checkout —Å–µ—Å—Å–∏–∏ Stripe
3. **POST `/api/v1/subscription/create-payment-link`** - —Å–æ–∑–¥–∞–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–π —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ–ø–ª–∞—Ç—É (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
4. **GET `/api/v1/subscription/check`** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏
5. **POST `/api/v1/subscription/cancel`** - –æ—Ç–º–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏
6. **POST `/api/v1/subscription/reactivate`** - —Ä–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏
7. **POST `/api/v1/webhook/stripe`** - webhook –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π Stripe

### –ö–ª—é—á–µ–≤–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

```python
@app.post("/api/v1/subscription/create-payment-link")
async def create_payment_link_public(
    user_email: Optional[str] = None,
    success_url: Optional[str] = None,
    cancel_url: Optional[str] = None
):
    """
    Create a public payment link for subscription
    Anyone can use this to subscribe - no authentication required
    """
```

–≠—Ç–æ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç —Å–æ–∑–¥–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—É—é —Å—Å—ã–ª–∫—É –¥–ª—è –æ–ø–ª–∞—Ç—ã –ø–æ–¥–ø–∏—Å–∫–∏, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

## üìã –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

1. –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø–æ–¥–ø–∏—Å–∫–∏ –∏–∑ `backend/main.py` –≤ `api/main.py`
2. –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ Stripe webhook –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–ø–∏—Å–∫–∏
3. –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ—Ä–Ω–µ–≤–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç `/` —Å –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ–º –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
4. –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã - –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —É–∂–µ –±—ã–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ `stripe_service.py` –∏ `supabase_client.py`

## üöÄ –î–µ–ø–ª–æ–π

–ü–æ—Å–ª–µ –∫–æ–º–º–∏—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

- –ü–æ–¥—Ö–≤–∞—Ç–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `api/main.py`
- –ó–∞–¥–µ–ø–ª–æ–∏—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é API
- –°–¥–µ–ª–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø–æ–¥–ø–∏—Å–∫–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **Health check**: `GET /health` ‚Üí –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ç—É—Å "healthy"
2. **Root endpoint**: `GET /` ‚Üí –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –≤–∫–ª—é—á–∞—è subscription\_\*
3. **Payment link**: `POST /api/v1/subscription/create-payment-link` ‚Üí –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å `payment_url`

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ API

```
/api/v1/
‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îú‚îÄ‚îÄ register          ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ login            ‚úÖ –í—Ö–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ me               ‚úÖ –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
‚îÇ   ‚îî‚îÄ‚îÄ profile          ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
‚îú‚îÄ‚îÄ subscription/
‚îÇ   ‚îú‚îÄ‚îÄ info             ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–ø–∏—Å–∫–µ
‚îÇ   ‚îú‚îÄ‚îÄ checkout         ‚úÖ Checkout —Å–µ—Å—Å–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ create-payment-link  ‚úÖ –ü—É–±–ª–∏—á–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –æ–ø–ª–∞—Ç—É
‚îÇ   ‚îú‚îÄ‚îÄ check            ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
‚îÇ   ‚îú‚îÄ‚îÄ cancel           ‚úÖ –û—Ç–º–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ reactivate       ‚úÖ –†–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è
‚îú‚îÄ‚îÄ webhook/
‚îÇ   ‚îî‚îÄ‚îÄ stripe           ‚úÖ Stripe webhook
‚îî‚îÄ‚îÄ [–¥—Ä—É–≥–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã]
```

## üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

- **–¢—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é**: `/info`, `/checkout`, `/check`, `/cancel`, `/reactivate`
- **–ü—É–±–ª–∏—á–Ω—ã–µ**: `/create-payment-link` (–º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –±–µ–∑ —Ç–æ–∫–µ–Ω–∞)

## üìä –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ Stripe

–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å:

- **Stripe Checkout** - –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–π –æ–ø–ª–∞—Ç—ã
- **Stripe Customer** - –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **Stripe Subscription** - –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∞–º–∏
- **Stripe Webhooks** - –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ Vercel –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã:

```env
STRIPE_API_KEY=sk_...
STRIPE_PRICE_ID=price_...
SUPABASE_URL=https://...
SUPABASE_KEY=eyJ...
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø–æ–¥–ø–∏—Å–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ Vercel
- ‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å payment links
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –æ—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
- ‚úÖ Webhook –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å—ã
- ‚úÖ `api/main.py` –∏ `backend/main.py` —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã

## üìå Commit

```
071b1e3 - fix: Add missing Stripe subscription endpoints to api/main.py for Vercel deployment
```

---

**–î–∞—Ç–∞:** 2025-10-02  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ –∑–∞–¥–µ–ø–ª–æ–µ–Ω–æ

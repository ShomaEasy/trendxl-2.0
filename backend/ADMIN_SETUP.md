# –ê–¥–º–∏–Ω-–∞–∫–∫–∞—É–Ω—Ç - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

## –û–ø–∏—Å–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∞–¥–º–∏–Ω-–∞–∫–∫–∞—É–Ω—Ç–æ–≤ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –æ–±—Ö–æ–¥–∏—Ç—å –≤—Å–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–∞ –±–µ–∑ –ª–∏–º–∏—Ç–æ–≤.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∞–¥–º–∏–Ω-–∞–∫–∫–∞—É–Ω—Ç–∞

‚úÖ **–ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º API endpoints –±–µ–∑ –ø–æ–¥–ø–∏—Å–∫–∏**
‚úÖ **–û–±—Ö–æ–¥ –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏**
‚úÖ **–ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ trend analysis**
‚úÖ **–ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Creative Center**
‚úÖ **–î–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º –±–µ–∑ –∫–∞–∫–∏—Ö-–ª–∏–±–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π**

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–°–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—è `is_admin` –≤ —Ç–∞–±–ª–∏—Ü—É `profiles`:

```bash
# –í–æ–π–¥–∏—Ç–µ –≤ Supabase Dashboard
# https://supabase.com/dashboard/project/jynidxwtbjrxmsbfpqra/editor

# –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∏–∑ —Ñ–∞–π–ª–∞: supabase_admin_migration.sql
```

–ò–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–æ—Ç SQL –Ω–∞–ø—Ä—è–º—É—é –≤ Supabase SQL Editor:

```sql
-- Add is_admin column to profiles table
ALTER TABLE profiles
ADD COLUMN IF NOT EXISTS is_admin BOOLEAN DEFAULT FALSE;

-- Create index for quick admin lookups
CREATE INDEX IF NOT EXISTS idx_profiles_is_admin ON profiles(is_admin) WHERE is_admin = TRUE;

-- Add comment explaining the field
COMMENT ON COLUMN profiles.is_admin IS 'Admin users have full access to all services without subscription limits';
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–¥–º–∏–Ω-—Å—Ç–∞—Ç—É—Å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

#### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ Python —Å–∫—Ä–∏–ø—Ç (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
cd backend

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
python set_admin.py your-email@example.com

# –£–¥–∞–ª–∏—Ç—å –∞–¥–º–∏–Ω-—Å—Ç–∞—Ç—É—Å
python set_admin.py your-email@example.com --remove
```

#### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ Supabase SQL Editor

```sql
-- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–¥–º–∏–Ω-—Å—Ç–∞—Ç—É—Å –ø–æ email
UPDATE profiles
SET is_admin = TRUE
WHERE email = 'your-email@example.com';

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
SELECT id, email, username, is_admin
FROM profiles
WHERE is_admin = TRUE;
```

#### –°–ø–æ—Å–æ–± 3: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤)

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:

```env
# –°–ø–∏—Å–æ–∫ email-–∞–¥—Ä–µ—Å–æ–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
ADMIN_EMAILS=admin@example.com,partner@example.com
```

–ó–∞—Ç–µ–º –æ–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, —á—Ç–æ–±—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–∑–Ω–∞—á–∞—Ç—å –∞–¥–º–∏–Ω-—Ä–æ–ª—å –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å —ç—Ç–∏–º–∏ email.

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∞—à–∏—Ö –∞–¥–º–∏–Ω-–∞–∫–∫–∞—É–Ω—Ç–æ–≤

### –î–ª—è –≤–∞—Å –∏ –≤–∞—à–µ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞:

1. **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç—ã** (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã):

   - –ó–∞–π–¥–∏—Ç–µ –Ω–∞ —Å–∞–π—Ç
   - –°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç—ã —Å –≤–∞—à–∏–º–∏ email-–∞–¥—Ä–µ—Å–∞–º–∏

2. **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é** –≤ Supabase (—Å–º. —Ä–∞–∑–¥–µ–ª –≤—ã—à–µ)

3. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∞–¥–º–∏–Ω-—Å—Ç–∞—Ç—É—Å** –¥–ª—è –æ–±–æ–∏—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤:

```bash
cd backend
python set_admin.py your-email@example.com
python set_admin.py partner-email@example.com
```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å**:

```bash
# –í–æ–π–¥–∏—Ç–µ –Ω–∞ —Å–∞–π—Ç —Å –≤–∞—à–∏–º –∞–∫–∫–∞—É–Ω—Ç–æ–º
# –ü—Ä–∏ –ª–æ–≥–∏–Ω–µ –≤—ã —É–≤–∏–¥–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏:
# üîë Admin user <username> bypassing subscription check
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∞–¥–º–∏–Ω-—Å—Ç–∞—Ç—É—Å–∞:

1. –ó–∞–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å —Å –∞–¥–º–∏–Ω-–∞–∫–∫–∞—É–Ω—Ç–æ–º
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å trend analysis –±–µ–∑ –ø–æ–¥–ø–∏—Å–∫–∏
3. –í –ª–æ–≥–∞—Ö –±—ç–∫–µ–Ω–¥–∞ –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
   ```
   üîë Admin user <username> bypassing subscription check
   ```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–ê–ñ–ù–û:**

- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–µ–ª–∏—Ç–µ—Å—å –∞–¥–º–∏–Ω-–¥–æ—Å—Ç—É–ø–æ–º —Å –¥—Ä—É–≥–∏–º–∏ –ª—é–¥—å–º–∏
- –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —Å–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω-email –≤ –ø—É–±–ª–∏—á–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:

```sql
SELECT id, email, username, is_admin, created_at
FROM profiles
WHERE is_admin = TRUE;
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: –ü–æ–ª–µ `is_admin` –≤ —Ç–∞–±–ª–∏—Ü–µ `profiles`
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ `auth_service_supabase.py`
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: –û–±—Ö–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –≤ `main.py`

### API Response

–ü—Ä–∏ –ª–æ–≥–∏–Ω–µ/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∞–¥–º–∏–Ω-–∞–∫–∫–∞—É–Ω—Ç–∞:

```json
{
  "access_token": "...",
  "token_type": "bearer",
  "user": {
    "id": "...",
    "email": "admin@example.com",
    "username": "admin",
    "is_admin": true
  }
}
```

### –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞–¥–º–∏–Ω-—Å—Ç–∞—Ç—É—Å–æ–º

```python
from auth_service_supabase import (
    get_user_admin_status,      # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
    set_user_admin_status,       # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ user_id
    set_user_admin_by_email      # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ email
)

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
is_admin = await get_user_admin_status(user_id)

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–¥–º–∏–Ω-—Å—Ç–∞—Ç—É—Å
success = await set_user_admin_by_email("admin@example.com", True)

# –£–¥–∞–ª–∏—Ç—å –∞–¥–º–∏–Ω-—Å—Ç–∞—Ç—É—Å
success = await set_user_admin_by_email("admin@example.com", False)
```

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –°–∫—Ä–∏–ø—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cd backend
source .env  # –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ python-dotenv

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase
python -c "from supabase_client import get_supabase; print(get_supabase())"
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ê–¥–º–∏–Ω-—Å—Ç–∞—Ç—É—Å –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞:

   ```sql
   SELECT column_name
   FROM information_schema.columns
   WHERE table_name = 'profiles' AND column_name = 'is_admin';
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –≤ –±–∞–∑–µ:

   ```sql
   SELECT email, is_admin FROM profiles WHERE email = 'your-email@example.com';
   ```

3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±—ç–∫–µ–Ω–¥ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ü—Ä–æ–±–ª–µ–º–∞: –õ–æ–≥–∏–Ω –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç is_admin

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `auth_service_supabase.py` –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∏ –≤—ã–∑—ã–≤–∞—é—Ç `get_user_admin_status()`.

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### Endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω-—Å—Ç–∞—Ç—É—Å–∞

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ `main.py`:

```python
@app.get("/api/v1/auth/check-admin")
async def check_admin_status(current_user: UserProfile = Depends(require_auth)):
    """Check if current user is admin"""
    return {
        "is_admin": current_user.is_admin,
        "message": "You have full admin access" if current_user.is_admin else "Regular user access"
    }
```

### Middleware –¥–ª—è –∞–¥–º–∏–Ω-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å middleware –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤.

---

**–°–æ–∑–¥–∞–Ω–æ**: 2 —è–Ω–≤–∞—Ä—è 2025  
**–í–µ—Ä—Å–∏—è**: 1.0  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

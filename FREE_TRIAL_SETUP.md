# üéÅ Free Trial System Setup Guide

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç —Å **1 –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º –∞–Ω–∞–ª–∏–∑–æ–º –≤ –¥–µ–Ω—å** –¥–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –ø–ª–∞—Ç–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏.

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å?

### –î–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:

- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–µ–∑ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–µ –º–æ–≥–ª–∏ –¥–µ–ª–∞—Ç—å –∞–Ω–∞–ª–∏–∑—ã
- ‚ùå –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç –ø–µ—Ä–µ–¥ –ø–æ–∫—É–ø–∫–æ–π

### –ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:

- ‚úÖ –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç 1 –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤ –¥–µ–Ω—å
- ‚úÖ –õ–∏–º–∏—Ç —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å (00:00 UTC)
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –ø–æ–¥–ø–∏—Å–∫–æ–π –ø–æ–ª—É—á–∞—é—Ç –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø
- ‚úÖ –ê–¥–º–∏–Ω—ã –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞: `daily_free_analyses`**

```sql
- user_id: UUID (—Å—Å—ã–ª–∫–∞ –Ω–∞ auth.users)
- analysis_date: DATE (–¥–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞)
- analysis_count: INTEGER (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–Ω–∞–ª–∏–∑–æ–≤ –∑–∞ –¥–µ–Ω—å)
- last_analysis_timestamp: TIMESTAMPTZ
- profile_analyzed: TEXT (–∫–∞–∫–æ–π –ø—Ä–æ—Ñ–∏–ª—å –±—ã–ª –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω)
```

**–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**

- `can_use_free_trial(user_id)` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –º–æ–∂–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—É—é –ø–æ–ø—ã—Ç–∫—É
- `record_free_trial_usage(user_id, profile)` - –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏
- `get_free_trial_info(user_id)` - –ø–æ–ª—É—á–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–ø—ã—Ç–∫–∞—Ö

### Backend (Python)

**–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `supabase_client.py`:**

- `can_use_free_trial(user_id)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏
- `record_free_trial_usage(user_id, profile)` - –∑–∞–ø–∏—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- `get_free_trial_info(user_id)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- `check_user_can_analyze(user_id)` - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ (–ø–æ–¥–ø–∏—Å–∫–∞ –∏–ª–∏ –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞)

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π endpoint `/api/v1/analyze`:**

- –¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ–¥–ø–∏—Å–∫—É, –Ω–æ –∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—à–∏–±–∫–∞—Ö —Å —Ç–∏–ø–æ–º –¥–æ—Å—Ç—É–ø–∞

**–ù–æ–≤—ã–π endpoint `/api/v1/free-trial/info`:**

- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
- –°–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è UI

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ Supabase

1. –û—Ç–∫—Ä—ã—Ç—å Supabase Dashboard
2. –ü–µ—Ä–µ–π—Ç–∏ –≤ SQL Editor
3. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `backend/supabase_free_trial_migration.sql`
4. –í—ã–ø–æ–ª–Ω–∏—Ç—å SQL –∑–∞–ø—Ä–æ—Å

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ç–∞–±–ª–∏—Ü—ã
SELECT * FROM public.daily_free_analyses LIMIT 1;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏
SELECT public.can_use_free_trial('your-user-uuid');
```

### –®–∞–≥ 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å backend

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
cd backend
python main.py

# Railway/Vercel - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
```

### –®–∞–≥ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –¢–µ—Å—Ç 1: –ü–µ—Ä–≤–∞—è –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞

```bash
# –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
# –°–¥–µ–ª–∞—Ç—å –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ñ–∏–ª—è
# –î–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —É—Å–ø–µ—à–Ω–æ ‚úÖ
```

#### –¢–µ—Å—Ç 2: –í—Ç–æ—Ä–∞—è –ø–æ–ø—ã—Ç–∫–∞ –≤ —Ç–æ—Ç –∂–µ –¥–µ–Ω—å

```bash
# –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–¥–µ–ª–∞—Ç—å –≤—Ç–æ—Ä–æ–π –∞–Ω–∞–ª–∏–∑
# –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ 403 —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ –ª–∏–º–∏—Ç–µ ‚ùå
```

#### –¢–µ—Å—Ç 3: –°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å

```bash
# –ü–æ–¥–æ–∂–¥–∞—Ç—å –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–Ω—è (–∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω–æ–µ –≤—Ä–µ–º—è)
# –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–¥–µ–ª–∞—Ç—å –∞–Ω–∞–ª–∏–∑
# –î–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —É—Å–ø–µ—à–Ω–æ ‚úÖ
```

#### –¢–µ—Å—Ç 4: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –ø–æ–¥–ø–∏—Å–∫–æ–π

```bash
# –û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
# –î–µ–ª–∞—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–Ω–∞–ª–∏–∑–æ–≤
# –í—Å–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å ‚úÖ
```

## API Endpoints

### GET `/api/v1/free-trial/info`

–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–ø—ã—Ç–∫–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (Bearer token)

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ–∑ –ø–æ–¥–ø–∏—Å–∫–∏):**

```json
{
  "is_admin": false,
  "has_subscription": false,
  "can_use_free_trial": true,
  "today_count": 0,
  "total_free_analyses": 5,
  "daily_limit": 1,
  "message": "You have 1 free analysis available today"
}
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ (–ª–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω):**

```json
{
  "is_admin": false,
  "has_subscription": false,
  "can_use_free_trial": false,
  "today_count": 1,
  "total_free_analyses": 5,
  "daily_limit": 1,
  "message": "You have used 1/1 free analyses today"
}
```

### POST `/api/v1/analyze`

–ê–Ω–∞–ª–∏–∑ TikTok –ø—Ä–æ—Ñ–∏–ª—è. –¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏.

**–û—à–∏–±–∫–∞ 403 (–ª–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω):**

```json
{
  "detail": {
    "error": "Analysis limit reached",
    "message": "You've used your free daily analysis. Subscribe to get unlimited access!",
    "today_count": 1,
    "action": "subscribe",
    "type": "free_trial_exhausted"
  }
}
```

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

```mermaid
graph TD
    A[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∞–Ω–∞–ª–∏–∑] --> B{–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω?}
    B -->|–ù–µ—Ç| C[401 - –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è]
    B -->|–î–∞| D{–ê–¥–º–∏–Ω?}
    D -->|–î–∞| E[–†–∞–∑—Ä–µ—à–∏—Ç—å –∞–Ω–∞–ª–∏–∑]
    D -->|–ù–µ—Ç| F{–ï—Å—Ç—å –ø–æ–¥–ø–∏—Å–∫–∞?}
    F -->|–î–∞| E
    F -->|–ù–µ—Ç| G{–ï—Å—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —Å–µ–≥–æ–¥–Ω—è?}
    G -->|–î–∞| H[–†–∞–∑—Ä–µ—à–∏—Ç—å –∞–Ω–∞–ª–∏–∑ + –∑–∞–ø–∏—Å–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ]
    G -->|–ù–µ—Ç| I[403 - –õ–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω]
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫

```sql
-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
SELECT COUNT(DISTINCT user_id) as free_users
FROM daily_free_analyses
WHERE analysis_date = CURRENT_DATE;

-- –¢–æ–ø-10 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
SELECT
    user_id,
    COUNT(*) as total_analyses,
    MAX(last_analysis_timestamp) as last_used
FROM daily_free_analyses
GROUP BY user_id
ORDER BY total_analyses DESC
LIMIT 10;

-- –ö–æ–Ω–≤–µ—Ä—Å–∏—è: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ—à–ª–∏ –Ω–∞ –ø–æ–¥–ø–∏—Å–∫—É –ø–æ—Å–ª–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
SELECT
    dfa.user_id,
    COUNT(dfa.id) as free_analyses_used,
    p.stripe_subscription_status as subscription_status
FROM daily_free_analyses dfa
JOIN profiles p ON dfa.user_id = p.id
WHERE p.stripe_subscription_status IN ('active', 'trialing')
GROUP BY dfa.user_id, p.stripe_subscription_status;
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### –ò–∑–º–µ–Ω–∏—Ç—å –ª–∏–º–∏—Ç –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: **1 –ø–æ–ø—ã—Ç–∫–∞ –≤ –¥–µ–Ω—å**

–ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å –ª–∏–º–∏—Ç, –æ–±–Ω–æ–≤–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `can_use_free_trial` –≤ SQL:

```sql
-- –ò–∑–º–µ–Ω–∏—Ç—å –ª–∏–º–∏—Ç —Å 1 –Ω–∞ 3 –ø–æ–ø—ã—Ç–∫–∏ –≤ –¥–µ–Ω—å
CREATE OR REPLACE FUNCTION public.can_use_free_trial(p_user_id UUID)
RETURNS BOOLEAN
LANGUAGE plpgsql
SECURITY DEFINER
AS $$
DECLARE
    v_today_count INTEGER;
    v_has_subscription BOOLEAN;
BEGIN
    -- ... (–∫–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏)

    -- –ò–∑–º–µ–Ω–∏—Ç—å —ç—Ç–æ —á–∏—Å–ª–æ –¥–ª—è –¥—Ä—É–≥–æ–≥–æ –ª–∏–º–∏—Ç–∞
    RETURN (v_today_count < 3);  -- –ë—ã–ª–æ: < 1
END;
$$;
```

### –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∑–∞–ø–∏—Å–µ–π —Å—Ç–∞—Ä—à–µ 90 –¥–Ω–µ–π:

```sql
-- –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é
SELECT public.cleanup_old_free_trial_records();

-- –ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å cron job –≤ Supabase (pg_cron)
SELECT cron.schedule(
    'cleanup-free-trial-records',
    '0 2 * * *',  -- –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00 AM
    $$SELECT public.cleanup_old_free_trial_records()$$
);
```

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –§—É–Ω–∫—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã

**–û—à–∏–±–∫–∞:**

```
ERROR: function public.can_use_free_trial(uuid) does not exist
```

**–†–µ—à–µ–Ω–∏–µ:**

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã:

```sql
SELECT proname FROM pg_proc WHERE proname LIKE '%free_trial%';
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—É—é –ø–æ–ø—ã—Ç–∫—É

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**

```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ
SELECT * FROM daily_free_analyses
WHERE user_id = 'your-user-uuid'
AND analysis_date = CURRENT_DATE;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é
SELECT public.can_use_free_trial('your-user-uuid');
```

**–°–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

```sql
-- –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å –∑–∞ —Å–µ–≥–æ–¥–Ω—è
DELETE FROM daily_free_analyses
WHERE user_id = 'your-user-uuid'
AND analysis_date = CURRENT_DATE;
```

### –ü—Ä–æ–±–ª–µ–º–∞: Backend –æ—à–∏–±–∫–∏

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:**

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
tail -f logs/backend.log | grep "free_trial"

# Railway
railway logs
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ Row Level Security (RLS) –≤–∫–ª—é—á–µ–Ω –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `daily_free_analyses`
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞–ø–∏—Å–∏
- ‚úÖ –§—É–Ω–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å –ø—Ä–∞–≤–∞–º–∏ `SECURITY DEFINER`
- ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏ –ª–∏–º–∏—Ç—ã —á–µ—Ä–µ–∑ API

## –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ:

1. **–ö–æ–Ω–≤–µ—Ä—Å–∏—è –≤ –ø–æ–¥–ø–∏—Å–∫—É** - —Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ–¥–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
2. **–£–¥–µ—Ä–∂–∞–Ω–∏–µ** - —Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å
3. **–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å** - —Å—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –¥–æ –ø–æ–¥–ø–∏—Å–∫–∏

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ Supabase
4. –û—Ç–∫—Ä–æ–π—Ç–µ issue –≤ GitHub

---

**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–î–∞—Ç–∞:** 2025-10-03  
**–ê–≤—Ç–æ—Ä:** TrendXL Team

# üìù –°–≤–æ–¥–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π: –°–∏—Å—Ç–µ–º–∞ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫

## üéÅ –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

–ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ç–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∞—é—Ç **1 –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤ –¥–µ–Ω—å** –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞!

## üìÇ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. `backend/supabase_client.py`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**

- `can_use_free_trial(user_id)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏
- `record_free_trial_usage(user_id, profile)` - –∑–∞–ø–∏—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- `get_free_trial_info(user_id)` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- `check_user_can_analyze(user_id)` - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞

### 2. `backend/main.py`

**–ò–∑–º–µ–Ω–µ–Ω–æ:**

- –ò–º–ø–æ—Ä—Ç—ã: –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `supabase_client`
- `/api/v1/analyze` endpoint: –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞
  - –¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ–¥–ø–∏—Å–∫—É
  - –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
  - –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**

- `/api/v1/free-trial/info` endpoint - —Å—Ç–∞—Ç—É—Å –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫

## üìÑ –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

### SQL –º–∏–≥—Ä–∞—Ü–∏—è:

1. `backend/supabase_free_trial_migration.sql` - –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –ë–î
   - –¢–∞–±–ª–∏—Ü–∞ `daily_free_analyses`
   - –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
   - RLS –ø–æ–ª–∏—Ç–∏–∫–∏

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:

2. `FREE_TRIAL_SETUP.md` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
3. `QUICK_START_FREE_TRIAL.md` - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (5 –º–∏–Ω—É—Ç)
4. `FREE_TRIAL_IMPLEMENTATION.md` - –∏—Ç–æ–≥–æ–≤–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
5. `CHANGES_SUMMARY.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

6. `backend/test_free_trial.py` - —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞
CREATE TABLE daily_free_analyses (
    user_id UUID,
    analysis_date DATE,
    analysis_count INTEGER,
    ...
    UNIQUE(user_id, analysis_date)
);
```

### API Changes

**Endpoint:** `POST /api/v1/analyze`

- –î–æ: —Ç—Ä–µ–±–æ–≤–∞–ª–∞—Å—å –ø–æ–¥–ø–∏—Å–∫–∞
- –ü–æ—Å–ª–µ: –ø–æ–¥–ø–∏—Å–∫–∞ –ò–õ–ò –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞

**–ù–æ–≤—ã–π endpoint:** `GET /api/v1/free-trial/info`

```json
{
  "can_use_free_trial": true,
  "today_count": 0,
  "daily_limit": 1,
  "message": "You have 1 free analysis available today"
}
```

## üöÄ –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å

### 1Ô∏è‚É£ –ü—Ä–∏–º–µ–Ω–∏—Ç—å SQL –º–∏–≥—Ä–∞—Ü–∏—é

```bash
# Supabase Dashboard ‚Üí SQL Editor
# –í—ã–ø–æ–ª–Ω–∏—Ç—å: backend/supabase_free_trial_migration.sql
```

### 2Ô∏è‚É£ –î–µ–ø–ª–æ–π

```bash
git add .
git commit -m "feat: Add 1 free daily analysis for new users"
git push origin main
```

### 3Ô∏è‚É£ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
python backend/test_free_trial.py <user-uuid>
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –¢–µ—Å—Ç 1: –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí –ê–Ω–∞–ª–∏–∑ ‚Üí ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- –í—Ç–æ—Ä–æ–π –∞–Ω–∞–ª–∏–∑ ‚Üí ‚ùå "–õ–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω"

### –¢–µ—Å—Ç 2: –°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å

- –ê–Ω–∞–ª–∏–∑ ‚Üí ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç (–ª–∏–º–∏—Ç —Å–±—Ä–æ—à–µ–Ω)

### –¢–µ—Å—Ç 3: –° –ø–æ–¥–ø–∏—Å–∫–æ–π

- –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏–∑—ã ‚Üí ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç

## üìä –û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç

1. **‚Üë –ö–æ–Ω–≤–µ—Ä—Å–∏—è** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–µ—Ä–µ–¥ –ø–æ–∫—É–ø–∫–æ–π
2. **‚Üë –ê–∫—Ç–∏–≤–∞—Ü–∏—è** - –±–æ–ª—å—à–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞–≤–µ—Ä—à–∞—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
3. **‚Üì –û—Ç—Ç–æ–∫** - –º–µ–Ω—å—à–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —É–π–¥—É—Ç –±–µ–∑ –ø–æ–ø—ã—Ç–∫–∏

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```sql
-- –°–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏?
SELECT COUNT(DISTINCT user_id) FROM daily_free_analyses
WHERE analysis_date = CURRENT_DATE;

-- –ö–æ–Ω–≤–µ—Ä—Å–∏—è –≤ –ø–æ–¥–ø–∏—Å–∫—É
SELECT COUNT(*) FROM profiles
WHERE id IN (SELECT DISTINCT user_id FROM daily_free_analyses)
AND stripe_subscription_status IN ('active', 'trialing');
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `FREE_TRIAL_SETUP.md`
- –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: `QUICK_START_FREE_TRIAL.md`
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: `python backend/test_free_trial.py`

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ production  
**–î–∞—Ç–∞:** 2025-10-03
